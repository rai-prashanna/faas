FROM golang:1.11

# go stuff
RUN go get -u github.com/kardianos/govendor && \
    go get -u -v github.com/codeskyblue/fswatch

RUN mkdir -p /go/src/github.com/modfin/faas-scaffold/digservice
WORKDIR /go/src/github.com/modfin/faas-scaffold/digservice

EXPOSE 6060

RUN echo "desc: Auto generated by fswatch [dig] \n\
triggers: \n\
- name: '' \n\
  pattens: \n\
  - '**/*.go' \n\
  env: \n\
    DEBUG: '1' \n\
  cmd: go run /go/src/github.com/modfin/faas-scaffold/digservice/src/main.go \n\
  shell: true \n\
  delay: 100ms \n\
  stop_timeout: 500ms \n\
  signal: KILL \n\
  kill_signal: '' \n\
watch_paths: \n\
- . \n\
watch_depth: 10 \n\
" >> /fsw.yml


COPY docker-entrypoint.sh /usr/local/bin/
RUN chmod a+x /usr/local/bin/docker-entrypoint.sh
RUN ln -s /usr/local/bin/docker-entrypoint.sh /entrypoint.sh # backwards compat
RUN chmod a+x /entrypoint.sh
ENTRYPOINT ["/entrypoint.sh"]